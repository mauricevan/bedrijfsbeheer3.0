# Werkorders / Workboard

ðŸ†• **VOLLEDIG VERNIEUWD + HISTORY VIEWER + INDEXERING**

## Overzicht

Persoonlijk Workboard Systeem met Kanban-stijl layout, volledige geschiedenis tracking en automatische factuur conversie.

## Functionaliteiten

### Voor Reguliere Users

#### Persoonlijk Workboard

- âœ… **Persoonlijk workboard** met alleen eigen toegewezen taken
- âœ… **Kanban-stijl layout** met 4 kolommen:
  - To Do
  - In Wacht
  - In Uitvoering
  - Afgerond
- âœ… **Uren registratie** per taak (bewerkbaar tijdens werk)
- âœ… **Status updaten** van eigen taken (Start / In Wacht Zetten / Voltooi)
- âœ… **Collega's taken bekijken** via dropdown (read-only)
- âœ… **Real-time statistieken** (to do/pending/in progress/completed/totaal uren)

#### Werkorder Details

- âœ… **Klant en locatie informatie** per werkorder
- âœ… **Geplande datum tracking**
- âœ… **Reden voor wachtstatus** - bij werkorders in wacht kan een reden worden opgegeven
- âœ… **Materiaalbeheer** - materialen uit voorraad koppelen aan werkorders

#### History Viewer

- ðŸ†• **History Viewer** - volledige geschiedenis van werkorder zien
- ðŸ†• **Timestamp Tracking** - zie wanneer taken zijn aangemaakt, toegewezen, gestart en voltooid
- ðŸ†• **Relatieve tijd weergave** - "2 dagen geleden", "5 uur geleden"

#### Weergave Opties

- ðŸ†• **Sorteerbare werkorders** - werkorders worden automatisch gesorteerd op indexnummer
- ðŸ†• **Compacte/Uitgebreide weergave toggle** - Schakel tussen:
  - **Compacte weergave**: Alleen omschrijving
  - **Uitgebreide weergave**: Volledige details

### Voor Admin

#### Volledig Overzicht

- âœ… **Volledig overzicht** van alle werkorders (dropdown "Alle medewerkers")
- ðŸ†• **Gegroepeerd per medewerker** - bij "Alle medewerkers" krijgt elke medewerker een eigen sectie
- ðŸ†• **Overzichtelijke weergave** - zie direct per medewerker wat er nog te doen is
- ðŸ†• **Intelligente medewerker filtering** (V5.6) - Bij status filtering worden alleen medewerkers getoond met werkorders in die status

#### Werkorder Beheer

- âœ… **Nieuwe werkorders aanmaken** en toewijzen
- âœ… **Werkorders aan specifieke medewerkers toewijzen**
- âœ… **Alle werkorders bewerken en verwijderen**
- âœ… **Overzicht filteren** per medewerker
- âœ… **Klant koppeling**

#### Materiaalbeheer & Voorraad

- âœ… **Wachtstatus beheer** - reden opgeven waarom een werkorder in wacht staat
- âœ… **Materiaalbeheer** - materialen uit voorraad toewijzen aan werkorders
- âœ… **Voorraad integratie** - automatische voorraad controle en aftrek bij voltooiing

#### Audit Trail & Historie

- ðŸ†• **Audit Trail** - volledige tracking van wie wat wanneer heeft gedaan
- ðŸ†• **History in Edit Modal** - zie volledige geschiedenis bij bewerken
- ðŸ†• **Uitklapbare geschiedenis** - timeline van alle wijzigingen

#### Werkorder Indexering Systeem

ðŸ†• Prioriteit en sortering met nummers:

- âœ… **Handmatig nummer toewijzen** - kies zelf het volgnummer (1, 2, 3, etc.)
- âœ… **Automatische nummering** - krijgt automatisch volgend nummer als je niets invult
- âœ… **Herschikken mogelijk** - pas indexnummer aan na aanmaken
- âœ… **Visuele weergave** - zie nummer in card (bijv. "#3")
- âœ… **Sortering** - werkorders gesorteerd op indexnummer (laagste eerst)
- âœ… **Flexibele prioritering** - geef belangrijke taken een laag nummer voor bovenaan

#### Weergave Toggle (Admin)

ðŸ†• **Compacte/Uitgebreide weergave toggle** - Toggle boven werkorders om tussen weergaven te schakelen:

- **Compacte weergave**: Alleen indexnummer en omschrijving (ideaal voor snel overzicht)
- **Uitgebreide weergave**: Volledige card met alle details (titel, beschrijving, materialen, uren, status, etc.)
- **Beide klikbaar** - Compacte en uitgebreide cards zijn dubbelklikbaar voor details

### Workflow & Integraties

#### Status Workflow

- âœ… **Status workflow**:
  - To Do â†’ In Progress â†’ Completed
  - Of: To Do â†’ Pending â†’ In Progress â†’ Completed
- âœ… **Materialen toewijzen** - benodigde materialen uit voorraad koppelen
- âœ… **Automatische voorraad update** - bij voltooien werkorder wordt voorraad automatisch bijgewerkt

#### Automatische Factuur Conversie

- ðŸ†• **Automatische factuur conversie** - Voltooide werkorders worden automatisch omgezet naar facturen in Boekhouding

#### Overige Integraties

- âœ… **Tijd registreren** per werkbon
- âœ… **Koppeling met voorraad & klantgegevens**

### Toekomstige Features

- ðŸ”„ **Digitaal aftekenen** door monteur
- ðŸ”„ **Fotobewijs** bij werkzaamheden
- ðŸ”„ **Automatische rapportages**

## History Viewer Functionaliteit

### Timestamp Summary (voor iedereen zichtbaar)

- ðŸ†• **Aangemaakt** - wanneer werkorder is aangemaakt
- ðŸ†• **Geconverteerd** - indien vanuit offerte/factuur (met link)
- ðŸ†• **Toegewezen** - wanneer aan medewerker toegewezen
- ðŸ†• **Gestart** - wanneer status gewijzigd naar "In Uitvoering"
- ðŸ†• **Voltooid** - wanneer werkorder is afgerond

### Uitklapbare Volledige Geschiedenis

- ðŸ†• **Alle acties** met tijdstip en uitvoerder
- ðŸ†• **Status wijzigingen** tracking
- ðŸ†• **Toewijzing wijzigingen** (van X naar Y)
- ðŸ†• **Iconen per actie type** (ðŸ†• created, ðŸ‘¤ assigned, ðŸ“Š status, etc.)
- ðŸ†• **"X dagen/uren geleden" weergave** (hover voor exacte tijd)
- ðŸ†• **Maximum 260px hoogte** met scroll voor lange histories

## Voordelen

- âœ… **Transparantie** - iedereen ziet wanneer taken zijn toegewezen
- âœ… **Verantwoordelijkheid** - wie heeft wat wanneer gedaan
- âœ… **Analyse** - inzicht in doorlooptijden en bottlenecks
- âœ… **Communicatie** - duidelijke historie voor team en klanten
- âœ… **Compliance** - audit trail voor kwaliteitsborging

## Gebruik

### Als Medewerker

1. **Open Werkorders module** - Zie je persoonlijke workboard
2. **Status updaten** - Sleep taken tussen kolommen of gebruik knoppen
3. **Uren registreren** - Voeg gewerkte uren toe bij voltooiing
4. **Materialen bekijken** - Zie welke materialen nodig zijn
5. **Historie bekijken** - Klik op werkorder voor volledige geschiedenis

### Als Admin

1. **Overzicht selecteren** - Kies "Alle medewerkers" of specifieke medewerker
2. **Nieuwe werkorder maken** - Vul titel, beschrijving, klant in
3. **Medewerker toewijzen** - Wijs toe aan specifieke medewerker
4. **Indexnummer instellen** - Geef prioriteit met laag nummer
5. **Materialen toewijzen** - Selecteer benodigde voorraad items
6. **Historie bekijken** - Zie volledige audit trail

## ðŸ› Troubleshooting

### Probleem: Werkorder status update faalt

**Symptomen:**
- Status kan niet naar volgende stap veranderen
- Knop "Start", "In Wacht Zetten" of "Voltooi" werkt niet
- Foutmelding bij status wijziging

**Oorzaak:**
- Materialen niet toegewezen (verplicht)
- Werkorder is al voltooid
- Geen rechten voor status update
- Database synchronisatie fout

**Oplossing:**
1. Zorg dat alle benodigde materialen zijn toegewezen
2. Check of werkorder niet al voltooid is
3. Check huidige rol in profiel (rechts bovenin)
4. Ververs de pagina (F5)
5. Check browser console (F12) voor details

---

### Probleem: Kanban drag-and-drop werkt niet

**Symptomen:**
- Werkorders kunnen niet tussen kolommen versleept worden
- Cursor toont geen drag-indicator
- Slepen werkt maar wijziging wordt niet opgeslagen

**Oorzaak:**
- Browser ondersteunt drag-and-drop niet goed
- Werkorder is vergrendeld (in bewerking door ander)
- JavaScript error in browser console
- Slechte internetverbinding

**Oplossing:**
1. Update naar nieuwste browser (Chrome 90+, Firefox 88+)
2. Clear browser cache (Ctrl+Shift+Delete)
3. Check browser console (F12) voor JavaScript errors
4. Ververs de pagina (F5)
5. Test in Incognito Mode

---

### Probleem: Filter/zoek werkt niet

**Symptomen:**
- Filter op medewerker geeft geen resultaten
- Zoektekst wordt genegeerd
- Geselecteerde status filter wordt niet toegepast

**Oorzaak:**
- Filter is niet correct ingesteld
- Zoektekst bevat speciale karakters
- Cache probleem
- Medewerker filter is leeg

**Oplossing:**
1. Reset filters door pagina te verversen (F5)
2. Check of juiste medewerker is geselecteerd
3. Probeer exacter zoekterm (zonder speciale karakters)
4. Clear browser cache (Ctrl+Shift+Delete)
5. Check of werkorders aan medewerker toegewezen zijn

---

### Veelvoorkomende Errors

#### Error: "Cannot update - materials required"
**Oorzaak:** Werkorder vereist minimaal Ã©Ã©n materiaal
**Oplossing:** Voeg materialen toe via "Materiaalbeheer" voor voltooiing

#### Error: "Permission denied for status update"
**Oorzaak:** Gebruiker heeft geen admin rechten
**Oplossing:** Vraag admin om status handmatig te wijzigen

#### Error: "Work order is locked"
**Oorzaak:** Werkorder wordt door ander bewerkt
**Oplossing:** Wacht totdat bewerking voltooid is, ververs dan pagina

---

### Performance Issues

**Symptomen:** Trage laadtijden, werkorders laden langzaam
**Mogelijke oorzaken:**
- Veel werkorders in systeem (> 1000)
- Veel materialen per werkorder
- Slechte internetverbinding

**Oplossingen:**
1. Filter op specifieke medewerker
2. Clear browser cache (Ctrl+Shift+Delete)
3. Check Network Tab in F12 voor trage requests
4. Zorg voor stabiele internetverbinding

---

### History Viewer Issues

**Symptomen:** History toont geen updates, timeline is leeg
**Oorzaak:**
- Werkorder is net aangemaakt (geen history nog)
- Database sync vertraging
**Oplossing:**
1. Wacht een paar seconden en ververs pagina
2. Voer wijziging uit om history te vullen
3. Check database connectie

---

### Tips voor Debugging

1. **Open Browser Console** (F12) om errors te zien
2. **Check Network Tab** voor API errors
3. **Refresh de pagina** (F5) bij rare gedrag
4. **Controleer materialen** bij status update problemen
5. **Test in Incognito Mode** om extensies uit te sluiten

## Gerelateerde Modules

- [Voorraadbeheer](./inventory.md) - Voor materiaalbeheer
- [Accounting](./accounting.md) - Voor automatische factuur conversie
- [CRM](./crm.md) - Voor klant koppeling
- [Planning](./planning.md) - Voor planning en roostering

## Versie Geschiedenis

- **V5.8** - Email integratie voor werkorder creatie vanuit emails
- **V5.6** - Intelligente medewerker filtering per status
- **V4.0** - History viewer, timestamp tracking, indexering systeem
